<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modifier un Client - Eureka Admin</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../assets/css/variables.css">
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/components.css">
    
    <!-- Select2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" rel="stylesheet" />
    
    <style>
        .form-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .form-section-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #292A5F;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #F3E600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-section-title i {
            color: #F3E600;
        }
        
        .required-field::after {
            content: " *";
            color: #dc3545;
        }
        
        .form-label {
            font-weight: 500;
            color: #495057;
            margin-bottom: 8px;
        }
        
        .form-control:focus,
        .form-select:focus {
            border-color: #F3E600;
            box-shadow: 0 0 0 0.2rem rgba(243, 230, 0, 0.25);
        }
        
        .btn-primary {
            background-color: #292A5F;
            border-color: #292A5F;
            padding: 12px 30px;
            font-weight: 500;
        }
        
        .btn-primary:hover {
            background-color: #1f2047;
            border-color: #1f2047;
        }
        
        .btn-outline-secondary {
            padding: 12px 30px;
            font-weight: 500;
        }
        
        .btn-danger {
            padding: 12px 30px;
            font-weight: 500;
        }
        
        .contact-entry {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid #dee2e6;
            position: relative;
        }
        
        .contact-entry .btn-remove-contact {
            position: absolute;
            top: 10px;
            right: 10px;
        }
        
        .btn-add-contact {
            background-color: #F3E600;
            color: #292A5F;
            border: none;
            font-weight: 500;
        }
        
        .btn-add-contact:hover {
            background-color: #d4c700;
            color: #292A5F;
        }
        
        .page-header {
            background: linear-gradient(135deg, #292A5F 0%, #3d3f7a 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
        }
        
        .page-header h1 {
            font-size: 1.8rem;
            font-weight: 600;
            margin: 0;
        }
        
        .page-header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
        }
        
        .commercial-card {
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s;
        }
        
        .commercial-card:hover {
            border-color: #F3E600;
            background-color: #fffef5;
        }
        
        .commercial-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #292A5F 0%, #F3E600 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1.2rem;
        }
        
        .select2-container--bootstrap-5 .select2-selection {
            min-height: 45px;
            padding: 8px 12px;
        }
        
        .info-badge {
            background-color: #e7f1ff;
            color: #004085;
            padding: 12px 15px;
            border-radius: 8px;
            border-left: 4px solid #0066cc;
            margin-bottom: 20px;
        }
        
        .info-badge i {
            margin-right: 8px;
        }
        
        .warning-badge {
            background-color: #fff3cd;
            color: #856404;
            padding: 12px 15px;
            border-radius: 8px;
            border-left: 4px solid #ffc107;
            margin-bottom: 20px;
        }
        
        .warning-badge i {
            margin-right: 8px;
        }
        
        .customer-id-badge {
            background-color: #f8f9fa;
            padding: 8px 15px;
            border-radius: 6px;
            font-size: 0.9rem;
            color: #6c757d;
        }
        
        .customer-id-badge strong {
            color: #292A5F;
        }
        
        .danger-zone {
            border: 2px solid #dc3545;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .danger-zone h6 {
            color: #dc3545;
            font-weight: 600;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div id="sidebar-container"></div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <button class="btn btn-link sidebar-toggle">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Rechercher...">
                </div>
            </div>
            <div class="header-right">
                <button class="btn btn-link notification-btn">
                    <i class="fas fa-bell"></i>
                    <span class="badge">3</span>
                </button>
                <div class="user-menu">
                    <img src="https://ui-avatars.com/api/?name=Admin+User&background=292A5F&color=F3E600" alt="User">
                    <span>Admin</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
            </div>
        </header>

        <!-- Page Content -->
        <div class="content-wrapper">
            <!-- Page Header -->
            <div class="page-header">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h1><i class="fas fa-user-edit me-2"></i>Modifier le Client</h1>
                        <p class="mb-2">Mettez à jour les informations du client</p>
                        <div class="customer-id-badge">
                            <strong>ID Client:</strong> CLT-2024-1523
                        </div>
                    </div>
                    <div class="d-flex gap-2">
                        <a href="customer-detail.html" class="btn btn-light">
                            <i class="fas fa-eye me-2"></i>Voir la fiche
                        </a>
                        <a href="customers-list.html" class="btn btn-light">
                            <i class="fas fa-arrow-left me-2"></i>Retour à la liste
                        </a>
                    </div>
                </div>
            </div>

            <!-- Info Badge -->
            <div class="info-badge">
                <i class="fas fa-info-circle"></i>
                Les champs marqués d'un astérisque (<span class="text-danger">*</span>) sont obligatoires.
            </div>
            
            <!-- Warning Badge -->
            <div class="warning-badge">
                <i class="fas fa-exclamation-triangle"></i>
                Dernière modification le <strong>15 Nov 2024 à 14:32</strong> par <strong>Sophie Martin</strong>
            </div>

            <!-- Form -->
            <form id="customerForm" novalidate>
                <!-- Informations Entreprise -->
                <div class="form-section">
                    <div class="form-section-title">
                        <i class="fas fa-building"></i>
                        Informations Entreprise
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label required-field">Nom de l'entreprise</label>
                            <input type="text" class="form-control" name="company_name" value="Tech Solar Industries" required>
                            <div class="invalid-feedback">Veuillez entrer le nom de l'entreprise.</div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label class="form-label required-field">Type d'entreprise</label>
                            <select class="form-select" name="company_type" required>
                                <option value="">Sélectionnez...</option>
                                <option value="SA">SA (Société Anonyme)</option>
                                <option value="SARL" selected>SARL (Société à Responsabilité Limitée)</option>
                                <option value="SAS">SAS (Société par Actions Simplifiée)</option>
                                <option value="SASU">SASU (Société par Actions Simplifiée Unipersonnelle)</option>
                                <option value="EURL">EURL (Entreprise Unipersonnelle à Responsabilité Limitée)</option>
                                <option value="EI">EI (Entreprise Individuelle)</option>
                                <option value="AUTO">Auto-entrepreneur</option>
                                <option value="AUTRE">Autre</option>
                            </select>
                            <div class="invalid-feedback">Veuillez sélectionner un type d'entreprise.</div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label required-field">SIRET</label>
                            <input type="text" class="form-control" name="siret" value="85234567890123" pattern="[0-9]{14}" required>
                            <div class="form-text">14 chiffres sans espaces</div>
                            <div class="invalid-feedback">Veuillez entrer un SIRET valide (14 chiffres).</div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Numéro TVA</label>
                            <input type="text" class="form-control" name="tva_number" value="FR12852345678">
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label required-field">Secteur d'activité</label>
                            <select class="form-select" name="sector" required>
                                <option value="">Sélectionnez...</option>
                                <option value="energie_renouvelable" selected>Énergie Renouvelable</option>
                                <option value="industrie">Industrie</option>
                                <option value="services">Services</option>
                                <option value="commerce">Commerce</option>
                                <option value="batiment">Bâtiment et Travaux Publics</option>
                                <option value="agriculture">Agriculture</option>
                                <option value="transport">Transport et Logistique</option>
                                <option value="technologie">Technologie</option>
                                <option value="sante">Santé</option>
                                <option value="education">Éducation</option>
                                <option value="autre">Autre</option>
                            </select>
                            <div class="invalid-feedback">Veuillez sélectionner un secteur d'activité.</div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Site web</label>
                            <input type="url" class="form-control" name="website" value="https://www.techsolar-industries.com" placeholder="https://www.exemple.com">
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Description</label>
                        <textarea class="form-control" name="description" rows="3" placeholder="Brève description de l'entreprise et de ses activités...">Entreprise spécialisée dans l'installation de panneaux solaires pour les professionnels et les collectivités. Leader régional avec plus de 500 installations réalisées.</textarea>
                    </div>
                </div>

                <!-- Adresse -->
                <div class="form-section">
                    <div class="form-section-title">
                        <i class="fas fa-map-marker-alt"></i>
                        Adresse
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label required-field">Adresse</label>
                        <input type="text" class="form-control" name="address" value="45 Avenue de l'Innovation" required>
                        <div class="invalid-feedback">Veuillez entrer l'adresse.</div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label class="form-label required-field">Code postal</label>
                            <input type="text" class="form-control" name="postal_code" value="69003" pattern="[0-9]{5}" required>
                            <div class="invalid-feedback">Veuillez entrer un code postal valide (5 chiffres).</div>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <label class="form-label required-field">Ville</label>
                            <input type="text" class="form-control" name="city" value="Lyon" required>
                            <div class="invalid-feedback">Veuillez entrer la ville.</div>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <label class="form-label required-field">Pays</label>
                            <select class="form-select" name="country" required>
                                <option value="">Sélectionnez...</option>
                                <option value="FR" selected>France</option>
                                <option value="BE">Belgique</option>
                                <option value="CH">Suisse</option>
                                <option value="LU">Luxembourg</option>
                                <option value="CA">Canada</option>
                                <option value="OTHER">Autre</option>
                            </select>
                            <div class="invalid-feedback">Veuillez sélectionner un pays.</div>
                        </div>
                    </div>
                </div>

                <!-- Contacts -->
                <div class="form-section">
                    <div class="form-section-title">
                        <i class="fas fa-users"></i>
                        Personnes de Contact
                    </div>
                    
                    <div id="contacts-container">
                        <!-- Contact 1 (Existant) -->
                        <div class="contact-entry" data-contact-index="1">
                            <button type="button" class="btn btn-sm btn-danger btn-remove-contact" onclick="removeContact(1)">
                                <i class="fas fa-times"></i>
                            </button>
                            
                            <h6 class="mb-3 text-muted">Contact Principal</h6>
                            
                            <div class="row">
                                <div class="col-md-3 mb-3">
                                    <label class="form-label">Civilité</label>
                                    <select class="form-select" name="contact_1_civility">
                                        <option value="M." selected>M.</option>
                                        <option value="Mme">Mme</option>
                                        <option value="Mlle">Mlle</option>
                                    </select>
                                </div>
                                
                                <div class="col-md-4 mb-3">
                                    <label class="form-label required-field">Prénom</label>
                                    <input type="text" class="form-control" name="contact_1_firstname" value="Jean" required>
                                    <div class="invalid-feedback">Champ obligatoire.</div>
                                </div>
                                
                                <div class="col-md-5 mb-3">
                                    <label class="form-label required-field">Nom</label>
                                    <input type="text" class="form-control" name="contact_1_lastname" value="Dupont" required>
                                    <div class="invalid-feedback">Champ obligatoire.</div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label class="form-label required-field">Email</label>
                                    <input type="email" class="form-control" name="contact_1_email" value="j.dupont@techsolar.com" required>
                                    <div class="invalid-feedback">Email invalide.</div>
                                </div>
                                
                                <div class="col-md-4 mb-3">
                                    <label class="form-label required-field">Téléphone</label>
                                    <input type="tel" class="form-control" name="contact_1_phone" value="04 78 90 12 34" required>
                                    <div class="invalid-feedback">Téléphone obligatoire.</div>
                                </div>
                                
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">Fonction</label>
                                    <input type="text" class="form-control" name="contact_1_position" value="Directeur Général">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Contact 2 (Existant) -->
                        <div class="contact-entry" data-contact-index="2">
                            <button type="button" class="btn btn-sm btn-danger btn-remove-contact" onclick="removeContact(2)">
                                <i class="fas fa-times"></i>
                            </button>
                            
                            <h6 class="mb-3 text-muted">Contact 2</h6>
                            
                            <div class="row">
                                <div class="col-md-3 mb-3">
                                    <label class="form-label">Civilité</label>
                                    <select class="form-select" name="contact_2_civility">
                                        <option value="M.">M.</option>
                                        <option value="Mme" selected>Mme</option>
                                        <option value="Mlle">Mlle</option>
                                    </select>
                                </div>
                                
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">Prénom</label>
                                    <input type="text" class="form-control" name="contact_2_firstname" value="Marie">
                                </div>
                                
                                <div class="col-md-5 mb-3">
                                    <label class="form-label">Nom</label>
                                    <input type="text" class="form-control" name="contact_2_lastname" value="Lefebvre">
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">Email</label>
                                    <input type="email" class="form-control" name="contact_2_email" value="m.lefebvre@techsolar.com">
                                </div>
                                
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">Téléphone</label>
                                    <input type="tel" class="form-control" name="contact_2_phone" value="04 78 90 12 35">
                                </div>
                                
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">Fonction</label>
                                    <input type="text" class="form-control" name="contact_2_position" value="Responsable Achats">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <button type="button" class="btn btn-add-contact" onclick="addContact()">
                        <i class="fas fa-plus me-2"></i>Ajouter un contact
                    </button>
                </div>

                <!-- Commercial Assigné -->
                <div class="form-section">
                    <div class="form-section-title">
                        <i class="fas fa-user-tie"></i>
                        Commercial Assigné
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label required-field">Sélectionnez le commercial responsable</label>
                        <select class="form-select" name="assigned_commercial" id="commercialSelect" required>
                            <option value="">Choisissez un commercial...</option>
                            <option value="1" data-name="Sophie Martin" data-email="sophie.martin@eureka.com" data-clients="45" selected>Sophie Martin</option>
                            <option value="2" data-name="Pierre Dubois" data-email="pierre.dubois@eureka.com" data-clients="38">Pierre Dubois</option>
                            <option value="3" data-name="Marie Laurent" data-email="marie.laurent@eureka.com" data-clients="52">Marie Laurent</option>
                            <option value="4" data-name="Thomas Bernard" data-email="thomas.bernard@eureka.com" data-clients="41">Thomas Bernard</option>
                            <option value="5" data-name="Julie Petit" data-email="julie.petit@eureka.com" data-clients="36">Julie Petit</option>
                            <option value="6" data-name="Lucas Moreau" data-email="lucas.moreau@eureka.com" data-clients="29">Lucas Moreau</option>
                        </select>
                        <div class="invalid-feedback">Veuillez sélectionner un commercial.</div>
                    </div>
                    
                    <!-- Carte du commercial sélectionné -->
                    <div id="commercialCard" class="commercial-card mt-3">
                        <div class="d-flex align-items-center">
                            <div class="commercial-avatar me-3" id="commercialAvatar">SM</div>
                            <div class="flex-grow-1">
                                <h6 class="mb-1" id="commercialName">Sophie Martin</h6>
                                <p class="mb-1 text-muted small" id="commercialEmail">
                                    <i class="fas fa-envelope me-2"></i>sophie.martin@eureka.com
                                </p>
                                <p class="mb-0 text-muted small" id="commercialClients">
                                    <i class="fas fa-users me-2"></i>45 clients
                                </p>
                            </div>
                            <div>
                                <span class="badge bg-success">Assigné</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Informations Complémentaires -->
                <div class="form-section">
                    <div class="form-section-title">
                        <i class="fas fa-info-circle"></i>
                        Informations Complémentaires
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Statut du client</label>
                            <select class="form-select" name="status">
                                <option value="prospect">Prospect</option>
                                <option value="lead">Lead</option>
                                <option value="client" selected>Client</option>
                                <option value="inactif">Inactif</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Source de prospection</label>
                            <select class="form-select" name="source">
                                <option value="">Sélectionnez...</option>
                                <option value="site_web">Site Web</option>
                                <option value="recommandation" selected>Recommandation</option>
                                <option value="salon">Salon / Événement</option>
                                <option value="appel_sortant">Appel Sortant</option>
                                <option value="reseaux_sociaux">Réseaux Sociaux</option>
                                <option value="publicite">Publicité</option>
                                <option value="partenaire">Partenaire</option>
                                <option value="autre">Autre</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Tags</label>
                        <select class="form-select" name="tags" id="tagsSelect" multiple>
                            <option value="vip" selected>VIP</option>
                            <option value="prioritaire" selected>Prioritaire</option>
                            <option value="grand_compte">Grand Compte</option>
                            <option value="pme" selected>PME</option>
                            <option value="startup">Startup</option>
                            <option value="collectivite">Collectivité</option>
                            <option value="particulier">Particulier</option>
                            <option value="international">International</option>
                        </select>
                        <div class="form-text">Maintenez Ctrl/Cmd pour sélectionner plusieurs tags</div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Notes internes</label>
                        <textarea class="form-control" name="internal_notes" rows="4" placeholder="Notes visibles uniquement par l'équipe interne...">Client très satisfait de nos services. A recommandé 3 nouveaux clients. Prévoir une visite de suivi au Q1 2025.</textarea>
                    </div>
                </div>

                <!-- Buttons -->
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div class="d-flex gap-2">
                        <a href="customer-detail.html" class="btn btn-outline-secondary">
                            <i class="fas fa-times me-2"></i>Annuler
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-2"></i>Enregistrer les modifications
                        </button>
                    </div>
                </div>
                
                <!-- Danger Zone -->
                <div class="danger-zone">
                    <h6><i class="fas fa-exclamation-triangle me-2"></i>Zone Dangereuse</h6>
                    <p class="text-muted mb-3">La suppression d'un client est irréversible. Toutes les données associées (dossiers, documents, historique) seront définitivement perdues.</p>
                    <button type="button" class="btn btn-danger" onclick="confirmDelete()">
                        <i class="fas fa-trash me-2"></i>Supprimer ce client
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-exclamation-triangle me-2"></i>Confirmer la suppression
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="mb-3">Êtes-vous absolument sûr de vouloir supprimer ce client ?</p>
                    <div class="alert alert-warning mb-3">
                        <strong>Attention :</strong> Cette action est <strong>irréversible</strong>. Toutes les données suivantes seront définitivement supprimées :
                        <ul class="mb-0 mt-2">
                            <li>Informations client et contacts</li>
                            <li>Dossiers et documents associés</li>
                            <li>Historique des transactions</li>
                            <li>Notes et rappels</li>
                        </ul>
                    </div>
                    <p class="mb-2"><strong>Pour confirmer, tapez le nom de l'entreprise :</strong></p>
                    <input type="text" class="form-control" id="deleteConfirmInput" placeholder="Tech Solar Industries">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn" disabled onclick="performDelete()">
                        <i class="fas fa-trash me-2"></i>Supprimer définitivement
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Select2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    
    <!-- Sidebar JS -->
    <script src="../assets/js/sidebar.js"></script>
    
    <script>
        let contactCounter = 2; // Already have 2 contacts
        const deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'));
        const companyName = 'Tech Solar Industries';
        
        // Initialize Select2 for tags
        $(document).ready(function() {
            $('#tagsSelect').select2({
                theme: 'bootstrap-5',
                placeholder: 'Sélectionnez des tags',
                allowClear: true
            });
            
            // Commercial select change
            $('#commercialSelect').on('change', function() {
                const selectedOption = $(this).find('option:selected');
                if (selectedOption.val()) {
                    const name = selectedOption.data('name');
                    const email = selectedOption.data('email');
                    const clients = selectedOption.data('clients');
                    
                    // Get initials
                    const initials = name.split(' ').map(n => n[0]).join('');
                    
                    $('#commercialAvatar').text(initials);
                    $('#commercialName').text(name);
                    $('#commercialEmail').html('<i class="fas fa-envelope me-2"></i>' + email);
                    $('#commercialClients').html('<i class="fas fa-users me-2"></i>' + clients + ' clients');
                    $('#commercialCard').fadeIn();
                } else {
                    $('#commercialCard').fadeOut();
                }
            });
            
            // Delete confirmation input
            $('#deleteConfirmInput').on('input', function() {
                const value = $(this).val().trim();
                $('#confirmDeleteBtn').prop('disabled', value !== companyName);
            });
        });
        
        // Add contact
        function addContact() {
            contactCounter++;
            const contactHTML = `
                <div class="contact-entry" data-contact-index="${contactCounter}">
                    <button type="button" class="btn btn-sm btn-danger btn-remove-contact" onclick="removeContact(${contactCounter})">
                        <i class="fas fa-times"></i>
                    </button>
                    
                    <h6 class="mb-3 text-muted">Contact ${contactCounter}</h6>
                    
                    <div class="row">
                        <div class="col-md-3 mb-3">
                            <label class="form-label">Civilité</label>
                            <select class="form-select" name="contact_${contactCounter}_civility">
                                <option value="M.">M.</option>
                                <option value="Mme">Mme</option>
                                <option value="Mlle">Mlle</option>
                            </select>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Prénom</label>
                            <input type="text" class="form-control" name="contact_${contactCounter}_firstname">
                        </div>
                        
                        <div class="col-md-5 mb-3">
                            <label class="form-label">Nom</label>
                            <input type="text" class="form-control" name="contact_${contactCounter}_lastname">
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" name="contact_${contactCounter}_email">
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Téléphone</label>
                            <input type="tel" class="form-control" name="contact_${contactCounter}_phone">
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Fonction</label>
                            <input type="text" class="form-control" name="contact_${contactCounter}_position" placeholder="Ex: Directeur, Responsable...">
                        </div>
                    </div>
                </div>
            `;
            
            $('#contacts-container').append(contactHTML);
        }
        
        // Remove contact
        function removeContact(index) {
            if (confirm('Êtes-vous sûr de vouloir supprimer ce contact ?')) {
                $(`.contact-entry[data-contact-index="${index}"]`).fadeOut(300, function() {
                    $(this).remove();
                });
            }
        }
        
        // Confirm delete
        function confirmDelete() {
            deleteModal.show();
        }
        
        // Perform delete
        function performDelete() {
            console.log('Deleting customer...');
            alert('Client supprimé avec succès.');
            window.location.href = 'customers-list.html';
        }
        
        // Form validation
        document.getElementById('customerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!this.checkValidity()) {
                e.stopPropagation();
                this.classList.add('was-validated');
                
                // Scroll to first error
                const firstInvalid = this.querySelector(':invalid');
                if (firstInvalid) {
                    firstInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    firstInvalid.focus();
                }
            } else {
                // Form is valid, show success message
                const formData = new FormData(this);
                console.log('Form data:', Object.fromEntries(formData));
                
                // Show success message
                alert('Modifications enregistrées avec succès !');
                
                // Redirect to customer detail
                window.location.href = 'customer-detail.html';
            }
        });
    </script>
</body>
</html>
